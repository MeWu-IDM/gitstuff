|Index|Group ID    |Depends On|Keras/Caffe|Task                                                                                   |Step                                                                                                                                                                                                           |Weaknesses                                                                                                   |Notes                                                                                                                                                                                                                                                                                                                                                                                                                                          |Frequency                 |Script                                                                                                                                                                 |Params                                                             |Input                                                                                                                                                                                                                                                                                   |Output                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |Hardware resources                                                                |Duration                                                         |Author          |Ready for PR |
|-----|------------|----------|-----------|---------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------|-------------|
|_R   |CNN train   |Q         |Caffe      |Caffe Training                                                                         |Ensure paths match docker paths                                                                                                                                                                                |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |Once per Nightlight Sample|Manual                                                                                                                                                                 |                                                                   |??? Input CSV                                                                                                                                                                                                                                                                           |??? Input CSV with path corrected                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                  |1 minute                                                         |Clinton         |Needs PR     |
|_S   |CNN train   |R         |Caffe      |Caffe Training                                                                         |Split data into Train/Test                                                                                                                                                                                     |                                                                                                             |Needs options for split % right now 70% need to know if spliting is necessary and how                                                                                                                                                                                                                                                                                                                                                          |Once per Nightlight Sample|https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/workflow/training-workflow/read_nl.py                                                            |Output directory                                                   |??? Input CSV                                                                                                                                                                                                                                                                           |Training data input - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/train.txt  /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/test.txt                                                                                                                                                                                                                                                                 |None                                                                              |1 minute                                                         |Jonathan/Clinton|Needs PR     |
|_T   |CNN train   |S         |Caffe      |Caffe Training                                                                         |Create LMDBS and means                                                                                                                                                                                         |                                                                                                             |Needs parsing of mean log input layer is 400, 400 (no resize needed)                                                                                                                                                                                                                                                                                                                                                                           |Once per Nightlight Sample|https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/workflow/training-workflow/create_lmdbs.sh                                                       |Base path to images  Weight file  Network prototxt  Solver.prototxt|/idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/                                                                                                                                                                                    |training input database - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/train.ldmb  test training database - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/test.ldmb  /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/mean_image_out  /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/ldmb.log|Needs Space for LMDB                                                              |1 hour                                                           |Clinton         |Needs PR     |
|_U   |CNN train   |T         |Caffe      |Caffe Training                                                                         |Train Caffe Model                                                                                                                                                                                              |                                                                                                             |Needs option to specify iterations training log and configuration can be found in the output folder need to be root permission                                                                                                                                                                                                                                                                                                                 |Once per Nightlight Sample|https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/workflow/training-workflow/train_model.sh                                                        |                                                                   |/idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/                                                                                                                                                                                    |Trained model snapshots - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/snapshots  training log - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/training.log  training png - /idm/ActiveDevelopmentProjects/socialMapping/model/nightlights_GSMregridded_5kmBuffered_dSamp-catGT/training.png                                                                                                         |GPU, LMDBs local                                                                  |6 hours                                                          |Clinton         |Needs PR     |
|_V   |CNN train   |Q         |Keras      |Build Keras-ready dataset                                                              |Create symlinks based on nl bins                                                                                                                                                                               |                                                                                                             |takes nightlights.csv , root path to the images and destination of symlinks create Keras input data structuture with label as folder name linux only if you run it twice, you may get duplicate (bug) should overwrite existing you can tar and untar the symlinks for reproducibility Mean needs to be calculated and then logged                                                                                                             |1x per dataset            |https://github.com/InstituteforDiseaseModeling/DataScience/blob/master/KERAS_FOR_SOCIAL_MAPPING/build_dataset_nl.py                                                    |/path/to/local_GSM_files, /path/to/create_symlinks                 |[nightlights.csv]                                                                                                                                                                                                                                                                       |[/path/to/symlinks]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                  |seconds                                                          |Jonathan        |Needs Package|
|_W   |CNN train   |V         |Keras      |Train model (tune imagenet)                                                            |Train                                                                                                                                                                                                          |                                                                                                             |docker image in artifactory need to calculate the mean subtraction                                                                                                                                                                                                                                                                                                                                                                             |1x per dataset            |https://github.com/InstituteforDiseaseModeling/DataScience/blob/master/KERAS_FOR_SOCIAL_MAPPING/train_imagenet_with_nl.py                                              |                                                                   |[path/to/symlinks]                                                                                                                                                                                                                                                                      |[/path/to/trained_model] (h5 and json)                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |DGX, idm_keras docker image                                                       |minutes                                                          |Jonathan        |Needs Package|
|_A   |Download    |L         |Both       |Download Google satellite images (GSM)                                                 |Simplify Shapefile                                                                                                                                                                                             |                                                                                                             |Currently I use GDAL and simply shape from 1m resolution to 300m resolution to improve runtimes. Need to save output shape to common location Dejan: need to look at the code to understand shape simplification part.                                                                                                                                                                                                                         |Once per country          |Manual                                                                                                                                                                 |                                                                   |DHS Shape file - /idm/ActiveDevelopmentProjects/socialMapping/data/input/DHS/NGGE6AFL/NGGE6AFL.shp                                                                                                                                                                                      |Optimzed Shape File                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                  |~5 minutes                                                       |Clinton         |             |
|_B   |Download    |A         |Both       |Download Google satellite images (GSM)                                                 |Generate image centerpoints                                                                                                                                                                                    |                                                                                                             |Output folder : always ../../data/output/pakisten/ (relative path to repo)                                                                                                                                                                                                                                                                                                                                                                     |Once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/mvg-dev/predicting-poverty/scripts/generate_clusters.py                                          |Spacing in Km, input path, output path                             |Optimized Shape File                                                                                                                                                                                                                                                                    |Image center points file - /idm/ActiveDevelopmentProjects/socialMapping/data/output/whole_country/nigeria/download_locs.txt                                                                                                                                                                                                                                                                                                                                                                                       |High CPU                                                                          |30 minutes                                                       |Clinton         |Not needed   |
|_C   |Download    |B         |Both       |Download Google satellite images (GSM)                                                 |Download image from centerpoints                                                                                                                                                                               |Needs a simple test to loop through downloaded images and load using image library to ensure images are valid|1 image out of a million fail: validation to check this (no error message, but gdal fails to load image, file corrupted)  skip redownload if existed  sync from dgx to p drive takes long time  Needs an update to point to specific download_locs. Currently it looks for any download_locs.txt under data/output directory.  Google API key is embed at moment. Should be a parameter or read from a config fole (currently Mollie's account)|Once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/mvg-dev/predicting-poverty/scripts/download_images.py                                            |None                                                               |                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |Disk I/O throughput, network throughput, disk storage (1TB)                       |6 hours                                                          |Clinton         |Not needed   |
|_D   |Download    |C         |Both       |Download Google satellite images (GSM)                                                 |Sync P Drive with downloaded images                                                                                                                                                                            |                                                                                                             |Not needed once we have everyone working from same location                                                                                                                                                                                                                                                                                                                                                                                    |Once per country          |Manual                                                                                                                                                                 |None                                                               |Downloaded images directory                                                                                                                                                                                                                                                             |Directory on P                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |Space on P                                                                        |6 hours                                                          |Clinton         |Not needed   |
|_E   |Download    |D         |Both       |Visualize Google satellite images                                                      |Geo-reference GSM .png files (at scale)                                                                                                                                                                        |                                                                                                             |transform png to geotiff group geotiff to 1:1 degree (for example 10.6, 5.4 -> (10,5) group) this steps take few days, CPU intensive  at scale in docker swarm: https://github.com/InstituteforDiseaseModeling/dda-socialmapping/tree/dejan/at-scale/viz/geo-reference#geo-procssing-referencing-and-visualization                                                                                                                             |once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/geo_reference_images.py                                         |-                                                                  |list of GSM images: P:\socialMapping\data\output\whole_country\nigeria\locs\??? (my copy: P:\socialMapping\viz\geo-reference\gsm\nigeria\input\downloaded_locs_1km.txt)  GSM image dir: P:\socialMapping\data\output\whole_country\google_maps\nigeria                                  |GSM GeoTIFF files:  P:\socialMapping\viz\geo-reference\gsm\nigeria\out\1km\merged                                                                                                                                                                                                                                                                                                                                                                                                                                 |CPU intensive, Docker swarm (mulitple machines), access to data on a network share|days                                                             |Dejan           |Needs PR     |
|_F   |Download    |E         |Both       |Visualize Google satellite images                                                      |Upload GSM .tiff files to GEE                                                                                                                                                                                  |                                                                                                             |manually upload them to GEE, user own account, 250G limit, 600G for negeria (some compression on their end)                                                                                                                                                                                                                                                                                                                                    |once per country          |manual, GEE UI                                                                                                                                                         |-                                                                  |GSM GeoTIFF files                                                                                                                                                                                                                                                                       |GEE collection of GSM GeoTIFF files                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |-                                                                                 |hours                                                            |Dejan           |             |
|_G   |Download    |F         |Both       |Visualize Google satellite images                                                      |Create GEE layers                                                                                                                                                                                              |                                                                                                             |Javascript(?) run on GEE                                                                                                                                                                                                                                                                                                                                                                                                                       |once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/gee/map_script.js                                               |-                                                                  |GEE collection of GSM GeoTIFF files                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |-                                                                                 |minutes                                                          |Dejan           |Needs PR     |
|_H   |Download    |N         |Both       |Visualize nightlights in QGIS                                                          |Add NL raster as a layer to QGIS project                                                                                                                                                                       |                                                                                                             |Need to do in GEE - no blocking issues for this (this could be done, but has not yet been done)                                                                                                                                                                                                                                                                                                                                                |once per country          |manual step, GEE UI                                                                                                                                                    |-                                                                  |NL raster: P:\socialMapping\data\input\Nightlights\2013\F182013.v4c_web.stable_lights.avg_vis.tif                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |-                                                                                 |minutes                                                          |Dejan           |             |
|_I   |Download    |L         |Both       |Visualize DHS data                                                                     |Geo-reference DHS numpy arrays                                                                                                                                                                                 |                                                                                                             |only assets, gdal to create shape from 2 np arrays                                                                                                                                                                                                                                                                                                                                                                                             |once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/geo_reference_array.py                                          |-                                                                  |numpy arrays: DHS indicator, lats and lons                                                                                                                                                                                                                                              |DHS indicator shape files (sqares and points)                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |-                                                                                 |minutes                                                          |Dejan           |Needs PR     |
|_J   |Download    |I         |Both       |Visualize DHS data                                                                     |Upload DHS indicator shapefiles to GEE                                                                                                                                                                         |                                                                                                             |manual                                                                                                                                                                                                                                                                                                                                                                                                                                         |once per country          |manual, GEE UI                                                                                                                                                         |-                                                                  |DHS indicator shape files (sqares and points)                                                                                                                                                                                                                                           |GEE stored DHS indicator shape files (sqares and points)                                                                                                                                                                                                                                                                                                                                                                                                                                                          |-                                                                                 |minutes                                                          |Dejan           |             |
|_K   |Download    |J         |Both       |Visualize DHS data                                                                     |Create GEE layers                                                                                                                                                                                              |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/gee/map_script.js                                               |-                                                                  |GEE stored DHS indicator shape files (sqares and points)                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |-                                                                                 |minutes                                                          |Dejan           |Needs PR     |
|_L   |Download    |None      |Both       |Download DHS                                                                           |                                                                                                                                                                                                               |                                                                                                             |you need special permissions to get DHS data: josh has access to asia-pacific data, mollie has access to African country data                                                                                                                                                                                                                                                                                                                  |                          |                                                                                                                                                                       |                                                                   |                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |                |             |
|_N   |Download    |          |Both       |Clip nightlights to country of interest  Write to .txt                                 |Set nightlights year to 2013 Load nightlights data (global) Look up country codes; get Nigeria country boundary Crop global NL to NIgeria boundary Make list from Nigeria NL raster values Save NL list as .txt|                                                                                                             |The outputs from this task went into post-process analysis (testing nightlights model against CNN models)... I think. 1km- ish resolution                                                                                                                                                                                                                                                                                                      |once per country          |extract_nigeria_nl.R                                                                                                                                                   |country                                                            |> nl <- raster(paste0('../data/input/Nightlights/', year, '/', list.files(paste0('../data/input/Nightlights/', year))))                                                                                                                                                                 |> write.table(nl_list,paste0('../data/output/whole_country/nigeria/nightlights.txt'),row.names=F)                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                  |                                                                 |Mollie          |             |
|_N   |Download    |None      |Both       |Download NL                                                                            |... (see Jean16 docs)                                                                                                                                                                                          |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |                                                                                                                                                                       |                                                                   |                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |                |             |
|DD   |Post-process|CC and U  |Caffe only |Extract features                                                                       |Generate feature vectors for images from specified CNN model Run only d{N}km for testing new CNN models                                                                                                        |Needs small set of verification on same model that is is repetable                                           |this is Caffe only (Pycaffe to extract)                                                                                                                                                                                                                                                                                                                                                                                                        |                          |run_extract_features_layers.ipynb                                                                                                                                      |                                                                   |downloaded_locs_{dNkm OR dense OR sparse}.txt  model/predicting_poverty.prototext  (Trained .caffemodel)  (Image mean values)                                                                                                                                                           |data/output/{whole_country, DHS}/nigeria/CNNmodels/{modelname}/sample_{name}/image_features.npy  Optional:norm1 filter maps  conv5 filter maps  viz_images                                                                                                                                                                                                                                                                                                                                                        |9 hours for all Nigeria  2-3 hours for DHS buffered (10km?)                       |                                                                 |Mollie          |             |
|EE   |Post-process|Z         |Keras      |Ingest Keras features into post-processing workflow                                    |                                                                                                                                                                                                               |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |{what is this???}                                                                                                                                                      |                                                                   |                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |                |             |
|FF   |Post-process|EE or DD  |           |Cluster features: dense                                                                |Group image features by DHS cluster Sub-sample: Smaller radius DHS clusters can be pulled from larger feature sets without running extract_features again                                                      |                                                                                                             |associate images to cluster, expensive process Alternate version is https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/mvg-dev/predicting-poverty/scripts/image_sampling.py                                                                                                                                                                                                                                                 |                          |run_feature_clustering.ipynb                                                                                                                                           |                                                                   |cluster_coords.npy  image_features.npy (source)  downloaded_locs_d{N}km.pkl (source)                                                                                                                                                                                                    |data/output/DHS/nigeria/CNNmodels/{modelName}/{sampleName}/ cluster_features_perImage.npy  cluster_features_perImage.pkl  If sub-sampling: image_features.npy (subset)  downloaded_locs_d{N}km.pkl (subset)                                                                                                                                                                                                                                                                                                       |                                                                                  |Expensive in Mollie's version;  much cheaper in Clinton's version|Mollie          |             |
|GG   |Post-process|FF or HH  |           |Aggregate features                                                                     |Aggregate sampled images to cluster level Also builds rural/urban split image sampling (e.g. _d5R2Ukm)                                                                                                         |Needs test to ensure it is repetable on same inputs                                                          |make aggregation of all feature for each image to one cluster, for example "MAX"                                                                                                                                                                                                                                                                                                                                                               |                          |run_feature_aggregation_dkm.ipynb                                                                                                                                      |                                                                   |cluster_features_perImage.npy                                                                                                                                                                                                                                                           |cluster_features_{aggregation_function}.npy                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                  |                                                                 |Mollie          |             |
|HH   |Post-process|EE or DD  |           |Cluster features: coarse                                                               |Alternately: coarse sampling                                                                                                                                                                                   |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |run_clustSamp_featAgg_coarse.ipynb                                                                                                                                     |                                                                   |                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |Mollie          |             |
|II   |Post-process|GG        |           |Build regression feature set                                                           |Pair CNN features with DHS GSC features for input to regressions One-time: save feature files with just GSC                                                                                                    |                                                                                                             |build LRR input Geo Spatial Covariance(GSC) for each indicator                                                                                                                                                                                                                                                                                                                                                                                 |                          |run_pair_CNN_GSC_features.ipynb                                                                                                                                        |                                                                   |DHS GSC data (NGGC6BFL.csv) Coordinates for GSC data (cluster_coords.txt) cluster_features_aggr npy/pkl cluster_coords.npy to match with cluster CNN features                                                                                                                           |cluster_features_[agg]GSC.npy and .pkl                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                  |                                                                 |Mollie          |             |
|JJ   |Post-process|II        |           |Run regression                                                                         |Model DHS indicators One-time: save per-image DHS survey data                                                                                                                                                  |                                                                                                             |normalization of attributes happen here in legacy FigUtils (older scikilearn package)                                                                                                                                                                                                                                                                                                                                                          |                          |run_regression.ipynb                                                                                                                                                   |                                                                   |Clustered feature vectors DHS indicator data                                                                                                                                                                                                                                            |Classified data (DHS model predictions) LRR model pickle Pickle with survey value matched to every image, cluster ID and coordinates included (this should probably be in an earlier script)                                                                                                                                                                                                                                                                                                                      |                                                                                  |                                                                 |Mollie          |             |
|KK   |Post-process|          |           |extra processing for per-image modeling fork                                           |Optional: Data slicing/analysis for per-image predictions                                                                                                                                                      |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |run_postprocess_perImage_model.ipynb                                                                                                                                   |                                                                   |Per-image modeled data DHS data                                                                                                                                                                                                                                                         |Modeled data with RSE Data frame with samples at percentiles of DHS indicators Arrays of cluster mean of per-image predictions                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                  |                                                                 |Mollie          |             |
|KK   |Post-process|          |           |Build country-wide map of DHS indicator prediction                                     |Classify country using gridded aggregated clustered features for whole-country and saved trained CNN model                                                                                                     |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |run_countryModel_classification.ipynb                                                                                                                                  |                                                                   |Cluster feature vectors DHS indicator data                                                                                                                                                                                                                                              |Country-wide classified data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                  |                                                                 |Mollie          |             |
|LL   |Post-Process|II        |Both       |Run ridge regression cross-validation at scale                                         |Run docker services                                                                                                                                                                                            |                                                                                                             |at scale in docker swarm: https://github.com/InstituteforDiseaseModeling/dda-socialmapping/tree/dejan/at-scale/predicting-poverty/at_scale/swarm  Does "run_cv" related code has to be python 2?                                                                                                                                                                                                                                               |?                         |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/predicting-poverty/at_scale/swarm/cv_runner.py                                    |param space (cnn modes, DHS indicators, radius, aggregation)       |CNN feature: P:\socialMapping\data\output\DHS\nigeria\CNNmodels\CNN_duSamp-catGT  DHS indicator arrays: P:\socialMapping\data\output\DHS\nigeria\indicators\assets\assets_survey.npy                                                                                                    |R2 arrays, DHS indicator predictions                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |CPU intensive, Docker swarm (mulitple machines), access to data on a network share|weeks                                                            |Dejan           |             |
|LL   |Post-process|          |           |different inputs for RSE criteria fork                                                 |Run regression on images with good RSE from per-image regression                                                                                                                                               |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |run_regression.ipynb                                                                                                                                                   |                                                                   |cluster_features_perImage.pkl  (indicator)_modeled_rse.pkl                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |Mollie          |             |
|_X   |Post-Process|W and CC  |Keras      |Extract features                                                                       |Create symlinks based on DHS dataset                                                                                                                                                                           |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |1x per dataset            |https://github.com/InstituteforDiseaseModeling/DataScience/blob/master/KERAS_FOR_SOCIAL_MAPPING/build_dataset_nl.py                                                    |/path/to/local_GSM_files, /path/to/create_symlinks                 |[dhs_image_dataset.csv]                                                                                                                                                                                                                                                                 |[/path/to/symlinks]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                  |seconds                                                          |Jonathan        |Needs Package|
|_Y   |Post-Process|X         |Keras      |Extract features                                                                       |Generate features from trained model                                                                                                                                                                           |                                                                                                             |Needs to read mean from V                                                                                                                                                                                                                                                                                                                                                                                                                      |1x per dataset            |https://github.com/InstituteforDiseaseModeling/DataScience/blob/master/KERAS_FOR_SOCIAL_MAPPING/train_imagenet_with_nl.py                                              |                                                                   |[/path/to/trained_model] (h5 and json), /path/to/DHS_input_imagery                                                                                                                                                                                                                      |features.csv, features_filenames.csv                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |DGX, idm_keras docker image                                                       |hour                                                             |Jonathan        |Needs Package|
|_Z   |Post-Process|Y         |Keras      |Extract features                                                                       |Merge & Clean features csv                                                                                                                                                                                     |Validate extract is repetable                                                                                |paste, sed, copy need validation on features (currently only basic checks like NaN)                                                                                                                                                                                                                                                                                                                                                            |1x per dataset            |Manual                                                                                                                                                                 |                                                                   |features.csv, features_filenames.csv                                                                                                                                                                                                                                                    |[/path/to/features.csv]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                  |seconds                                                          |Jonathan        |Needs Package|
|     |Post-process|          |           |                                                                                       |Fit and save a mean-subtraction scaler calculated on image-level features (deprecated?)                                                                                                                        |                                                                                                             |                                                                                                                                                                                                                                                                                                                                                                                                                                               |                          |run_fit_scaler.ipynb                                                                                                                                                   |                                                                   |image_features.npy                                                                                                                                                                                                                                                                      |image_features_scaler.pkl                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                  |                                                                 |Mollie          |             |
|AA   |Preprocess  |L         |           |Ingest DHS                                                                             |Pull HH indicator data Transform indicators as needed Aggregate HH to cluster-level Write cluster coordinates from DHS file; Write DHS indicators to .txt                                                      |                                                                                                             |data extraction 20 min raw data stata file, need validation  - Need permissions to download DHS data                                                                                                                                                                                                                                                                                                                                           |                          |ProcessSurveyData.R (the whole DHS data extraction)  or ProcessSurveyData_extractClusterCoords.R (just the cluster coords) followed by save_clust_coords.py            |                                                                   |GE DHS file                                                                                                                                                                                                                                                                             |../data/output/DHS/nigeria/locs/cluster_coords.txt                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                  |minutes                                                          |Mollie          |             |
|BB   |Preprocess  |AA        |           |Ingest DHS                                                                             |Translate .txt to .np Filter out clusters that are erroneously located on (0,0); clusters missing RS data.                                                                                                     |Do we need need it straight to numpy? Can we ingest original numpy? Can we make a library to load this data? |cluster filtering, this is a mess                                                                                                                                                                                                                                                                                                                                                                                                              |                          |save_survey_data.py                                                                                                                                                    |                                                                   |# Retrieve DHS data [os.path.join('../data/output/DHS'),country_majuscule+' '+year+'DHS_'+modelvar+' (Cluster).txt']                                                                                                                                                                    |# Save .npy files names = ['lats', 'lons', 'assets', 'nightlights', 'households']                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                  |                                                                 |Mollie          |             |
|CC   |Preprocess  |BB        |           |Create location files for image sampling (input to extract features among other things)|One-time: generate custom download_locs.txt files for different sampling schemes                                                                                                                               |                                                                                                             |restricting number of images used in the feature extraction not sure if buffer happens(?)                                                                                                                                                                                                                                                                                                                                                      |                          |run_image_sampling.ipynb  *This is to restrict the number of images that must be run through extract_features when working with different radii around DHS points.     |                                                                   |data/output/whole_country/nigeria/downloaded_locs_dense.txt or: data/output/whole_country/pakistan/downloaded_locs_1km.txt  data/output/DHS/nigeria/locs/cluster_coords.npy                                                                                                             |data/output/DHS/nigeria/locs/downloaded_locs_d{N}km.txt  data/output/DHS/nigeria/locs/downloaded_locs_d{N}km.pkl                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                  |                                                                 |Mollie          |             |
|_O   |Preprocess  |N         |Both       |Re-grid and bin nightlights to GSM grid                                                |Clip and polygonize NL raster into a shape file                                                                                                                                                                |                                                                                                             |manual, extent determined visually, could be determined by using the same DHS shape as used for download (though not necessary)  clipping night light world raster by extent                                                                                                                                                                                                                                                                   |once per country          |manual, in QGIS or https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/weighted_averages/polygonize_night_lights.cmd|-                                                                  |NL raster: P:\socialMapping\data\input\Nightlights\2013\F182013.v4c_web.stable_lights.avg_vis.tif  extent: N2-16, E2-16                                                                                                                                                                 |NL shape file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |-                                                                                 |minutes                                                          |Dejan           |Needs PR     |
|_P   |Preprocess  |O         |Both       |Re-grid and bin nightlights to GSM grid                                                |Run weighted averages calculation (at scale)                                                                                                                                                                   |                                                                                                             |at scale in docker swarm: https://github.com/InstituteforDiseaseModeling/dda-socialmapping/tree/dejan/at-scale/viz/geo-reference#geo-procssing-referencing-and-visualization                                                                                                                                                                                                                                                                   |once per country          |https://github.com/InstituteforDiseaseModeling/dda-socialmapping/blob/dejan/at-scale/viz/geo-reference/weighted_averages/calculate_weighted_averages.py                |-                                                                  |list of GSM images: P:\socialMapping\data\output\whole_country\nigeria\locs\???  NL shape file: P:\socialMapping\data\input\Nightlights\2013\Nigeria\F182013.v4c_web.stable_lights.avg_vis_N2-N16-E2-E16.shp                                                                            |list of GSM images with NL bins and weighted average values                                                                                                                                                                                                                                                                                                                                                                                                                                                       |CPU intensive, Docker swarm (mulitple machines), access to data on a network share|days                                                             |Dejan           |Needs PR     |
|_Q   |Preprocess  |P         |Both       |Build nightlight training dataset                                                      |Spatial subsetting to survey buffered locations  Rebin nightlights according to GMM  Up/downsample imagery to balance nightlight intensities in training data                                                  |                                                                                                             |Up/downsampling routine (coding optimization).  High likelihood of easy improvement. buffer to 5km rebin (change the thrashold) change (1-3) to (0-2)                                                                                                                                                                                                                                                                                          |                          |run_preprocess_training_NL.ipynb	                                                                                                                                      |                                                                   |data/input/Nightlights/2013/  F182013.v4c_web.stable_lights.avg_vis_N2-N16-E2-E16_GSM_weighted_averages.csv  This is the GSM-regridded file that Dejan made. Preprocessing includes rebinning (rounding) OLS nightlights to integer values and resetting the category labels to (0,1,2).|	 data/input/Nightlights/2013  nightlights_GSMregridded_*.csv  Output files include versions with different geographical subsetting, different up/downsampling schemes.                                                                                                                                                                                                                                                                                                                                           |                                                                                  |As much as 1-2 hours for creating a new up/downsampled file.	    |Mollie          |             |
